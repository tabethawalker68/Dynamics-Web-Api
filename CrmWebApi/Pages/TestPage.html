<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
</head>
<body>
    <button onclick="CreateRecord()">Create Record</button>
    <button onclick="UpdateRecord()">Update Record</button>
    <button onclick="RetrieveRecord()">Retrieve Record</button>
    <button onclick="CountRecords()">Count Records</button>
    <button onclick="DeleteRecord()">Delete Record</button>
    <button onclick="UpsertRecord()">Upsert Record</button>
    <button onclick="RetrieveMultipleRecordsExtended()">Multiple Records Extended</button>
    <script src="../../clientGlobalcontext.js.aspx"></script>
    <script src="../Scripts/CrmWebApi.js"></script>
    <script>
        var recordId = "115a8970-d788-4bf6-b064-d1574dbe6930";
        CrmWebApi.crmWebApiVersion = "8.1";

        function CreateRecord() {
            var lead = {
                subject: "Test WebAPI",
                firstname: "Test",
                lastname: "WebAPI",
                jobtitle: "Title"
            };
            CrmWebApi.createRecord(lead, "lead").then(function (id) {
                alert(id);
                recordId = id;
            }).catch(function (error) {
                debugger;
            })
        }
        function RetrieveRecord() {
            CrmWebApi.retrieveRecord(recordId, "lead", ["fullname", "subject"], null).then(function (object) {
                debugger;
            })
            .catch(function (error) {
                debugger;
                console.trace(error.message);
            });
        }
        function CountRecords() {
            CrmWebApi.countRecords("lead", "statecode eq 0").then(function (count) {
                alert(count);
            })
            .catch(function (error) {
                debugger;
                console.trace(error.message);
            });
        }
        function retrieveMultipleRecordsAdvanced() {
            var request = {
                type: "lead",
                select: ["fullname", "subject"],
                filter: "statecode eq 0",
                maxPageSize: 5
            };

            CrmWebApi.retrieveMultipleRecordsExtended(request).then(function (object) {
                debugger;
            })
            .catch(function (error) {
                debugger;
                console.trace(error.message);
            });
        }
        function DeleteRecord() {
            CrmWebApi.deleteRecord(recordId, "lead").then(function () {
                alert("success!");
            })
            .catch(function (error) {
                debugger;
                console.trace(error.message);
            });
        }
        function UpdateRecord() {
            var lead = {
                subject: "Test update"
            }

            CrmWebApi.updateRecord(recordId, "lead", lead).then(function () {
                alert("updated!");
            })
            .catch(function (error) {
                debugger;
                console.trace(error.message);
            });
        }
        function UpsertRecord() {
            var lead = {
                subject: "Upsert!!"
            };

            CrmWebApi.upsertRecord(recordId, "lead", lead, "*").then(function (id) {
                if (id != null) {
                    recordId = id;
                }
            })
            .catch(function (error) {
                debugger;
                console.trace(error.message);
            });
        }
        function UpdateSingleProperty() {
            CrmWebApi.updateSingleProperty(recordId, "lead", { key: "subject", value: "Update Single" }).then(function () {
                alert("success!");
            })
            .catch(function (error) {
                debugger;
                console.trace(error.message);
            });
        }
    </script>
</body>

</html>
