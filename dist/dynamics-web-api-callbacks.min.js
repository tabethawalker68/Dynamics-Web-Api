/*! dynamics-web-api-callbacks v1.4.7 (c) 2018 Aleksandr Rogov */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("DynamicsWebApi",[],t):"object"==typeof exports?exports.DynamicsWebApi=t():e.DynamicsWebApi=t()}(this,function(){return function(e){function t(i){if(a[i])return a[i].exports;var n=a[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var a={};return t.m=e,t.c=a,t.i=function(e){return e},t.d=function(e,a,i){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t){var a={Types:{ResponseBase:function(){this.oDataContext=""},Response:function(){a.Types.ResponseBase.call(this),this.value={}},ReferenceResponse:function(){a.Types.ResponseBase.call(this),this.id="",this.collection=""},MultipleResponse:function(){a.Types.ResponseBase.call(this),this.oDataNextLink="",this.oDataCount=0,this.value=[]},FetchXmlResponse:function(){a.Types.ResponseBase.call(this),this.value=[],this.PagingInfo={cookie:"",page:0,nextPage:1}}},Prefer:{ReturnRepresentation:"return=representation",Annotations:{AssociatedNavigationProperty:"Microsoft.Dynamics.CRM.associatednavigationproperty",LookupLogicalName:"Microsoft.Dynamics.CRM.lookuplogicalname",All:"*",FormattedValue:"OData.Community.Display.V1.FormattedValue",FetchXmlPagingCookie:"Microsoft.Dynamics.CRM.fetchxmlpagingcookie"}}};e.exports=a},function(e,t){function a(e,t,a){throw new Error(a?e+" requires the "+t+" parameter to be of type "+a:e+" requires the "+t+" parameter.")}var i={handleErrorResponse:function(e){throw new Error("Error: "+e.status+": "+e.message)},parameterCheck:function(e,t,i,n){void 0!==e&&null!==e&&""!=e||a(t,i,n)},stringParameterCheck:function(e,t,i){"string"!=typeof e&&a(t,i,"String")},arrayParameterCheck:function(e,t,i){e.constructor!==Array&&a(t,i,"Array")},stringOrArrayParameterCheck:function(e,t,i){e.constructor!==Array&&"string"!=typeof e&&a(t,i,"String or Array")},numberParameterCheck:function(e,t,i){if("number"!=typeof e){if("string"==typeof e&&e&&!isNaN(parseInt(e)))return;a(t,i,"Number")}},boolParameterCheck:function(e,t,i){"boolean"!=typeof e&&a(t,i,"Boolean")},guidParameterCheck:function(e,t,i){try{return/[0-9A-F]{8}[-]?([0-9A-F]{4}[-]?){3}[0-9A-F]{12}/i.exec(e)[0]}catch(e){a(t,i,"GUID String")}},keyParameterCheck:function(e,t,n){try{i.stringParameterCheck(e,t,n);var r=/[0-9A-F]{8}[-]?([0-9A-F]{4}[-]?){3}[0-9A-F]{12}/i.exec(e);if(r)return r[0];var c=e.split(",");if(c.length)for(var o=0;o<c.length;o++)c[o]=c[o].trim().replace('"',"'"),/^[\w\d\_]+\=('[^\'\r\n]+'|\d+)$/i.exec(c[o])[0];return c.join(",")}catch(e){a(t,n,"String representing GUID or Alternate Key")}},callbackParameterCheck:function(e,t,i){"function"!=typeof e&&a(t,i,"Function")}};e.exports=i},function(e,t){String.prototype.endsWith=function(e,t){var a=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>a.length)&&(t=a.length),t-=e.length;var i=a.lastIndexOf(e,t);return-1!==i&&i===t},String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e}},function(e,t,a){function i(e,t,a,n,o){var s={},l=[];if(n=null!=n?n:"&",e){if(e.navigationProperty){if(r.stringParameterCheck(e.navigationProperty,"DynamicsWebApi."+t,"request.navigationProperty"),a+="/"+e.navigationProperty,e.navigationPropertyKey){a+="("+r.keyParameterCheck(e.navigationPropertyKey,"DynamicsWebApi."+t,"request.navigationPropertyKey")+")"}"Attributes"===e.navigationProperty&&e.metadataAttributeType&&(r.stringParameterCheck(e.metadataAttributeType,"DynamicsWebApi."+t,"request.metadataAttributeType"),a+="/"+e.metadataAttributeType)}if(null!=e.select&&e.select.length&&(r.arrayParameterCheck(e.select,"DynamicsWebApi."+t,"request.select"),"retrieve"==t&&1==e.select.length&&e.select[0].endsWith("/$ref")?a+="/"+e.select[0]:(e.select[0].startsWith("/")&&"retrieve"==t&&(null==e.navigationProperty?a+=e.select.shift():e.select.shift()),e.select.length&&l.push("$select="+e.select.join(",")))),e.filter){r.stringParameterCheck(e.filter,"DynamicsWebApi."+t,"request.filter");for(var u=/[^"']{([\w\d]{8}[-]?(?:[\w\d]{4}[-]?){3}[\w\d]{12})}(?:[^"']|$)/g,p=e.filter;null!==(m=u.exec(p));){m.index===u.lastIndex&&regex.lastIndex++;var y=m[0].endsWith(")")?")":" ";p=p.replace(m[0]," "+m[1]+y)}l.push("$filter="+encodeURIComponent(p))}e.savedQuery&&l.push("savedQuery="+r.guidParameterCheck(e.savedQuery,"DynamicsWebApi."+t,"request.savedQuery")),e.userQuery&&l.push("userQuery="+r.guidParameterCheck(e.userQuery,"DynamicsWebApi."+t,"request.userQuery")),e.count&&(r.boolParameterCheck(e.count,"DynamicsWebApi."+t,"request.count"),l.push("$count="+e.count)),e.top&&e.top>0&&(r.numberParameterCheck(e.top,"DynamicsWebApi."+t,"request.top"),l.push("$top="+e.top)),null!=e.orderBy&&e.orderBy.length&&(r.arrayParameterCheck(e.orderBy,"DynamicsWebApi."+t,"request.orderBy"),l.push("$orderby="+e.orderBy.join(",")));var h=c(e,t,o);if(h.length&&(s.Prefer=h),null!=e.ifmatch&&null!=e.ifnonematch)throw new Error("DynamicsWebApi."+t+". Either one of request.ifmatch or request.ifnonematch parameters should be used in a call, not both.");if(e.ifmatch&&(r.stringParameterCheck(e.ifmatch,"DynamicsWebApi."+t,"request.ifmatch"),s["If-Match"]=e.ifmatch),e.ifnonematch&&(r.stringParameterCheck(e.ifnonematch,"DynamicsWebApi."+t,"request.ifnonematch"),s["If-None-Match"]=e.ifnonematch),e.impersonate&&(r.stringParameterCheck(e.impersonate,"DynamicsWebApi."+t,"request.impersonate"),s.MSCRMCallerID=r.guidParameterCheck(e.impersonate,"DynamicsWebApi."+t,"request.impersonate")),e.token&&(r.stringParameterCheck(e.token,"DynamicsWebApi."+t,"request.token"),s.Authorization="Bearer "+e.token),e.duplicateDetection&&(r.boolParameterCheck(e.duplicateDetection,"DynamicsWebApi."+t,"request.duplicateDetection"),s["MSCRM.SuppressDuplicateDetection"]="false"),e.entity&&r.parameterCheck(e.entity,"DynamicsWebApi."+t,"request.entity"),e.data&&r.parameterCheck(e.data,"DynamicsWebApi."+t,"request.data"),e.noCache&&(r.boolParameterCheck(e.noCache,"DynamicsWebApi."+t,"request.noCache"),s["Cache-Control"]="no-cache"),e.mergeLabels&&(r.boolParameterCheck(e.mergeLabels,"DynamicsWebApi."+t,"request.mergeLabels"),s["MSCRM.MergeLabels"]="true"),e.expand&&e.expand.length)if(r.stringOrArrayParameterCheck(e.expand,"DynamicsWebApi."+t,"request.expand"),"string"==typeof e.expand)l.push("$expand="+e.expand);else{for(var f=[],b=0;b<e.expand.length;b++)if(e.expand[b].property){var d=i(e.expand[b],t+" $expand",null,";"),k=d.query;k&&k.length&&(k="("+k+")"),f.push(e.expand[b].property+k)}f.length&&l.push("$expand="+f.join(","))}}return{url:a,query:l.join(n),headers:s}}function n(e,t,a){var n,c="";return e.url?(r.stringParameterCheck(e.url,"DynamicsWebApi."+t,"request.url"),c=e.url.replace(a.webApiUrl,""),n=i(e,t,c,"&",a)):(e._unboundRequest||e.collection||r.parameterCheck(e.collection,"DynamicsWebApi."+t,"request.collection"),e.collection&&(r.stringParameterCheck(e.collection,"DynamicsWebApi."+t,"request.collection"),c=e.collection,e.key?e.key=r.keyParameterCheck(e.key,"DynamicsWebApi."+t,"request.key"):e.id&&(e.key=r.guidParameterCheck(e.id,"DynamicsWebApi."+t,"request.id")),e.key&&(c+="("+e.key+")")),e._additionalUrl&&(c&&(c+="/"),c+=e._additionalUrl),n=i(e,t,c,"&",a),e.fetchXml?(r.stringParameterCheck(e.fetchXml,"DynamicsWebApi."+t,"request.fetchXml"),n.url+="?fetchXml="+encodeURIComponent(e.fetchXml)):n.query&&(n.url+="?"+n.query)),e.hasOwnProperty("async")&&null!=e.async?(r.boolParameterCheck(e.async,"DynamicsWebApi."+t,"request.async"),n.async=e.async):n.async=!0,{url:n.url,headers:n.headers,async:n.async}}var r=(a(0),a(1)),c=a(12),o={convertRequestOptions:i,convertRequest:n};e.exports=o},function(e,t,a){function i(e){return void 0===e||"unknown"==typeof e||null==e}function n(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var a=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?a:3&a|8).toString(16)})}function r(){if("undefined"!=typeof GetGlobalContext)return GetGlobalContext();if("undefined"!=typeof Xrm){if(!i(Xrm.Utility)&&!i(Xrm.Utility.getGlobalContext))return Xrm.Utility.getGlobalContext();if(!i(Xrm.Page)&&!i(Xrm.Page.context))return Xrm.Page.context}throw new Error("Xrm Context is not available. In most cases, it can be resolved by adding a reference to a ClientGlobalContext.js.aspx. Please refer to MSDN documentation for more details.")}function c(){var e=r();if(e){var t=e.getClientUrl();return t.match(/\/$/)&&(t=t.substring(0,t.length-1)),t}return""}function o(e){return c()+"/api/data/v"+e+"/"}function s(){return"undefined"!=typeof Xrm?Xrm.Internal:null}var l={buildFunctionParameters:a(11),getFetchXmlPagingCookie:a(14),convertToReferenceObject:a(13),isNull:i,generateUUID:n,getXrmContext:r,getXrmInternal:s,getClientUrl:c,initWebApiUrl:o};e.exports=l},function(e,t,a){function i(e){var t=m.getXrmInternal();if(!m.isNull(t)){var a=t.getEntitySetName(e);return a||e}var a=null;if(!m.isNull(p)&&(a=p[e],m.isNull(a)))for(var i in p)if(p[i]==e)return e;return a}function n(e){return e.Accept="application/json",e["OData-MaxVersion"]="4.0",e["OData-Version"]="4.0",e["Content-Type"]="application/json; charset=utf-8",e}function r(e,t){var a;return e&&(a=JSON.stringify(e,function(e,a){if(e.endsWith("@odata.bind")||e.endsWith("@odata.id")){if("string"==typeof a){if(/\(\{[\w\d-]+\}\)/g.test(a)&&(a=a.replace(/(.+)\(\{([\w\d-]+)\}\)/g,"$1($2)")),t.useEntityNames){var n=/([\w_]+)(\([\d\w-]+\))$/,r=n.exec(a);if(r.length>2){var c=i(r[1]);m.isNull(c)||(a=a.replace(n,c+"$2"))}}a.startsWith(t.webApiUrl)||(a=t.webApiUrl+a.replace(/^\\/,""))}}else(e.startsWith("oData")||e.endsWith("_Formatted")||e.endsWith("_NavigationProperty")||e.endsWith("_LogicalName"))&&(a=void 0);return a}),a=a.replace(/[\u007F-\uFFFF]/g,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).substr(-4)})),a}function c(e,t,i,c,o,s,l,u){o||(o={}),o=n(o);var p=r(c,i);if(t.length>2e3){var y="dwa_batch_"+m.generateUUID(),h=[];h.push("--"+y),h.push("Content-Type: application/http"),h.push("Content-Transfer-Encoding: binary\n"),h.push(e+" "+i.webApiUrl+t+" HTTP/1.1");for(var f in o)h.push(f+": "+o[f]),"Authorization"!=f&&delete o[f];h.push("\n--"+y+"--"),p=h.join("\n"),o=n(o),o["Content-Type"]="multipart/mixed;boundary="+y,t="$batch",e="POST"}i.impersonate&&!o.MSCRMCallerID&&(o.MSCRMCallerID=i.impersonate);var b;b=a(10);var d=function(a){a&&(o||(o={}),o.Authorization="Bearer "+(a.hasOwnProperty("accessToken")?a.accessToken:a)),b(e,i.webApiUrl+t,p,o,s,l,u)};i.onTokenRefresh&&(!o||o&&!o.Authorization)?i.onTokenRefresh(d):d()}function o(e,t,a,n){var r=function(t){p={};for(var n=0;n<t.data.value.length;n++)p[t.data.value[n].LogicalName]=t.data.value[n].LogicalCollectionName;a(i(e))},o=function(e){n({message:"Unable to fetch EntityDefinitions. Error: "+e.message})},s=y.convertRequest({collection:"EntityDefinitions",select:["LogicalCollectionName","LogicalName"],noCache:!0},"retrieveMultiple",t);c("GET",s.url,t,null,s.headers,r,o,s.async)}function s(e){return["EntityDefinitions","$metadata","RelationshipDefinitions","GlobalOptionSetDefinitions","ManagedPropertyDefinitions"].indexOf(e)>-1}function l(e,t,a,n){if(s(e)||m.isNull(e))return void a(e);if(e=e.toLowerCase(),!t.useEntityNames)return void a(e);try{var r=i(e);m.isNull(r)?o(e,t,a,n):a(r)}catch(e){n({message:"Unable to fetch Collection Names. Error: "+e.message})}}function u(e,t,a,i,n,r){var o=function(o){t.collection=o;var s=y.convertRequest(t,a,i);c(e,s.url,i,t.data||t.entity,s.headers,n,r,s.async)};l(t.collection,i,o,r)}var p,m=(a(0),a(4)),y=a(3);e.exports={sendRequest:c,makeRequest:u,getCollectionName:i}},function(e,t,a){function i(e){var t={webApiVersion:"8.0",webApiUrl:"",impersonate:null,onTokenRefresh:null,includeAnnotations:null,maxPageSize:null,returnRepresentation:null};e||(e=t),this.setConfig=function(e){e.webApiVersion&&(c.stringParameterCheck(e.webApiVersion,"DynamicsWebApi.setConfig","config.webApiVersion"),t.webApiVersion=e.webApiVersion),e.webApiUrl?(c.stringParameterCheck(e.webApiUrl,"DynamicsWebApi.setConfig","config.webApiUrl"),t.webApiUrl=e.webApiUrl):t.webApiUrl=r.initWebApiUrl(t.webApiVersion),e.impersonate&&(t.impersonate=c.guidParameterCheck(e.impersonate,"DynamicsWebApi.setConfig","config.impersonate")),e.onTokenRefresh&&(c.callbackParameterCheck(e.onTokenRefresh,"DynamicsWebApi.setConfig","config.onTokenRefresh"),t.onTokenRefresh=e.onTokenRefresh),e.includeAnnotations&&(c.stringParameterCheck(e.includeAnnotations,"DynamicsWebApi.setConfig","config.includeAnnotations"),t.includeAnnotations=e.includeAnnotations),e.maxPageSize&&(c.numberParameterCheck(e.maxPageSize,"DynamicsWebApi.setConfig","config.maxPageSize"),t.maxPageSize=e.maxPageSize),e.returnRepresentation&&(c.boolParameterCheck(e.returnRepresentation,"DynamicsWebApi.setConfig","config.returnRepresentation"),t.returnRepresentation=e.returnRepresentation),e.useEntityNames&&(c.boolParameterCheck(e.useEntityNames,"DynamicsWebApi.setConfig","config.useEntityNames"),t.useEntityNames=e.useEntityNames)},this.setConfig(e);var a=function(e,a,i,n,r){o.makeRequest(e,a,i,t,n,r)};this.createRequest=function(e,t,i){c.parameterCheck(e,"DynamicsWebApi.create","request"),c.callbackParameterCheck(t,"DynamicsWebApi.create","successCallback"),c.callbackParameterCheck(i,"DynamicsWebApi.create","errorCallback"),a("POST",e,"create",function(e){if(e.data)t(e.data);else{var a=e.headers["OData-EntityId"]?e.headers["OData-EntityId"]:e.headers["odata-entityid"],i=/([0-9A-F]{8}[-]?([0-9A-F]{4}[-]?){3}[0-9A-F]{12})\)$/i.exec(a)[1];t(i)}},i)},this.create=function(e,t,a,i,n,r){c.parameterCheck(e,"DynamicsWebApi.create","object"),c.stringParameterCheck(t,"DynamicsWebApi.create","collection"),n&&c.stringOrArrayParameterCheck(n,"DynamicsWebApi.create","prefer"),r&&c.arrayParameterCheck(r,"DynamicsWebApi.create","select");var o={collection:t,select:r,prefer:n,entity:e};this.createRequest(o,a,i)},this.updateRequest=function(e,t,i){c.parameterCheck(e,"DynamicsWebApi.update","request"),c.callbackParameterCheck(t,"DynamicsWebApi.update","successCallback"),c.callbackParameterCheck(i,"DynamicsWebApi.update","errorCallback"),null==e.ifmatch&&(e.ifmatch="*");var n=function(e){t(e.data?e.data:!0)},r=e.ifmatch,o=function(e){r&&412===e.status?t(!1):i(e)},s=/EntityDefinitions|RelationshipDefinitions|GlobalOptionSetDefinitions/.test(e.collection)?"PUT":"PATCH";a(s,e,"update",n,o)},this.update=function(e,t,a,i,n,r,o){c.stringParameterCheck(e,"DynamicsWebApi.update","key"),e=c.keyParameterCheck(e,"DynamicsWebApi.update","key"),c.parameterCheck(a,"DynamicsWebApi.update","object"),c.stringParameterCheck(t,"DynamicsWebApi.update","collection"),c.callbackParameterCheck(i,"DynamicsWebApi.update","successCallback"),c.callbackParameterCheck(n,"DynamicsWebApi.update","errorCallback"),r&&c.stringOrArrayParameterCheck(r,"DynamicsWebApi.update","prefer"),o&&c.arrayParameterCheck(o,"DynamicsWebApi.update","select");var s={collection:t,key:e,select:o,prefer:r,entity:a};this.updateRequest(s,i,n)},this.updateSingleProperty=function(e,t,i,n,r,o,s){c.stringParameterCheck(e,"DynamicsWebApi.updateSingleProperty","key"),e=c.keyParameterCheck(e,"DynamicsWebApi.updateSingleProperty","key"),c.parameterCheck(i,"DynamicsWebApi.updateSingleProperty","keyValuePair"),c.stringParameterCheck(t,"DynamicsWebApi.updateSingleProperty","collection"),c.callbackParameterCheck(n,"DynamicsWebApi.updateSingleProperty","successCallback"),c.callbackParameterCheck(r,"DynamicsWebApi.updateSingleProperty","errorCallback"),o&&c.stringOrArrayParameterCheck(o,"DynamicsWebApi.updateSingleProperty","prefer"),s&&c.arrayParameterCheck(s,"DynamicsWebApi.updateSingleProperty","select");var l=Object.keys(i)[0],u=i[l];a("PUT",{collection:t,key:e,select:s,prefer:o,navigationProperty:l,data:{value:u}},"updateSingleProperty",function(e){e.data?n(e.data):n()},r)},this.deleteRequest=function(e,t,i){c.parameterCheck(e,"DynamicsWebApi.delete","request"),c.callbackParameterCheck(t,"DynamicsWebApi.delete","successCallback"),c.callbackParameterCheck(i,"DynamicsWebApi.delete","errorCallback");var n=function(){t(!0)},r=e.ifmatch;a("DELETE",e,"delete",n,function(e){r&&412===e.status?t(!1):i(e)})},this.deleteRecord=function(e,t,i,n,r){c.stringParameterCheck(e,"DynamicsWebApi.delete","key"),e=c.keyParameterCheck(e,"DynamicsWebApi.delete","key"),c.stringParameterCheck(t,"DynamicsWebApi.delete","collection"),c.callbackParameterCheck(i,"DynamicsWebApi.delete","successCallback"),c.callbackParameterCheck(n,"DynamicsWebApi.delete","errorCallback"),null!=r&&c.stringParameterCheck(r,"DynamicsWebApi.delete","propertyName"),a("DELETE",{key:e,collection:t,navigationProperty:r},"delete",function(e){i()},n)},this.retrieveRequest=function(e,t,i){c.parameterCheck(e,"DynamicsWebApi.retrieve","request"),c.callbackParameterCheck(t,"DynamicsWebApi.retrieve","successCallback"),c.callbackParameterCheck(i,"DynamicsWebApi.retrieve","errorCallback");var n=e.select;a("GET",e,"retrieve",function(e){t(null!=n&&1===n.length&&n[0].endsWith("/$ref")&&null!=e.data["@odata.id"]?r.convertToReferenceObject(e.data):e.data)},i)},this.retrieve=function(e,t,a,i,n,r){c.stringParameterCheck(e,"DynamicsWebApi.retrieve","key"),e=c.keyParameterCheck(e,"DynamicsWebApi.retrieve","key"),c.stringParameterCheck(t,"DynamicsWebApi.retrieve","collection"),c.callbackParameterCheck(a,"DynamicsWebApi.retrieve","successCallback"),c.callbackParameterCheck(i,"DynamicsWebApi.retrieve","errorCallback"),n&&n.length&&c.arrayParameterCheck(n,"DynamicsWebApi.retrieve","select"),r&&r.length&&c.stringOrArrayParameterCheck(r,"DynamicsWebApi.retrieve","expand");var o={collection:t,key:e,select:n,expand:r};this.retrieveRequest(o,a,i)},this.upsertRequest=function(e,t,i){c.parameterCheck(e,"DynamicsWebApi.upsert","request"),c.parameterCheck(e.entity,"DynamicsWebApi.upsert","request.entity"),c.callbackParameterCheck(t,"DynamicsWebApi.upsert","successCallback"),c.callbackParameterCheck(i,"DynamicsWebApi.upsert","errorCallback");var n=e.ifnonematch,r=e.ifmatch;a("PATCH",e,"upsert",function(e){if(e.headers["OData-EntityId"]||e.headers["odata-entityid"]){var a=e.headers["OData-EntityId"]?e.headers["OData-EntityId"]:e.headers["odata-entityid"],i=/[0-9A-F]{8}[-]?([0-9A-F]{4}[-]?){3}[0-9A-F]{12}/i.exec(a)[0];t(i)}else e.data?t(e.data):t()},function(e){n&&412===e.status?t():r&&404===e.status?t():i(e)})},this.upsert=function(e,t,a,i,n,r,o){c.stringParameterCheck(e,"DynamicsWebApi.upsert","key"),e=c.keyParameterCheck(e,"DynamicsWebApi.upsert","key"),c.parameterCheck(a,"DynamicsWebApi.upsert","object"),c.stringParameterCheck(t,"DynamicsWebApi.upsert","collection"),c.callbackParameterCheck(i,"DynamicsWebApi.upsert","successCallback"),c.callbackParameterCheck(n,"DynamicsWebApi.upsert","errorCallback"),r&&c.stringOrArrayParameterCheck(r,"DynamicsWebApi.upsert","prefer"),o&&c.arrayParameterCheck(o,"DynamicsWebApi.upsert","select");var s={collection:t,key:e,select:o,prefer:r,entity:a};this.upsertRequest(s,i,n)},this.count=function(e,t,i,n){if(null==n||null!=n&&!n.length){c.stringParameterCheck(e,"DynamicsWebApi.count","collection"),c.callbackParameterCheck(t,"DynamicsWebApi.count","successCallback"),c.callbackParameterCheck(i,"DynamicsWebApi.count","errorCallback");a("GET",{collection:e,navigationProperty:"$count"},"count",function(e){t(e.data?parseInt(e.data):0)},i)}else this.retrieveMultipleRequest({collection:e,filter:n,count:!0},function(e){t(e.oDataCount?e.oDataCount:0)},i)},this.countAll=function(e,t,a,i,n){this.retrieveAllRequest({collection:e,filter:i,select:n},function(e){t(e&&e.value?e.value.length:0)},a)},this.retrieveMultiple=function(e,t,a,i,n,r){this.retrieveMultipleRequest({collection:e,select:i,filter:n},t,a,r)},this.retrieveAll=function(e,t,a,i,n){l({collection:e,select:i,filter:n},t,a)};var s=function(e,t,i,n){c.callbackParameterCheck(t,"DynamicsWebApi.retrieveMultiple","successCallback"),c.callbackParameterCheck(i,"DynamicsWebApi.retrieveMultiple","errorCallback"),n&&(c.stringParameterCheck(n,"DynamicsWebApi.retrieveMultiple","nextPageLink"),e.url=n);var r=e.count;a("GET",e,"retrieveMultiple",function(e){r&&(e.data.oDataCount=e.data.oDataCount||0),t(e.data)},i)};this.retrieveMultipleRequest=s;var l=function(e,t,a,i,n){n=n||[],s(e,function(i){n=n.concat(i.value),i.oDataNextLink?l(e,t,a,i.oDataNextLink,n):t({value:n})},a,i)};this.retrieveAllRequest=function(e,t,a){l(e,t,a)};var u=function(e,t,i,o,s,l,u,p){c.stringParameterCheck(e,"DynamicsWebApi.executeFetchXml","collection"),c.stringParameterCheck(t,"DynamicsWebApi.executeFetchXml","fetchXml"),c.callbackParameterCheck(i,"DynamicsWebApi.executeFetchXml","successCallback"),c.callbackParameterCheck(o,"DynamicsWebApi.executeFetchXml","errorCallback"),l=l||1,c.numberParameterCheck(l,"DynamicsWebApi.executeFetchXml","pageNumber");var m='$1 page="'+l+'"';null!=u&&(c.stringParameterCheck(u,"DynamicsWebApi.executeFetchXml","pagingCookie"),m+=' paging-cookie="'+u+'"'),t=t.replace(/^(<fetch)/,m),a("GET",{collection:e,includeAnnotations:s,impersonate:p,fetchXml:t},"executeFetchXml",function(e){null!=e.data["@"+n.Prefer.Annotations.FetchXmlPagingCookie]&&(e.data.PagingInfo=r.getFetchXmlPagingCookie(e.data["@"+n.Prefer.Annotations.FetchXmlPagingCookie],l)),i(e.data)},o)};this.fetch=u,this.executeFetchXml=u;var p=function(e,t,a,i,n,r,c,o,s){s=s||[],u(e,t,function(r){s=s.concat(r.value),r.PagingInfo?p(e,t,a,i,n,r.PagingInfo.nextPage,r.PagingInfo.cookie,o,s):a({value:s})},i,n,r,c,o)},m=function(e,t,a,i,n,r){p(e,t,a,i,n,null,null,r)};this.fetchAll=m,this.executeFetchXmlAll=m,this.associate=function(e,t,i,n,r,o,s,l){c.stringParameterCheck(e,"DynamicsWebApi.associate","collection"),c.stringParameterCheck(n,"DynamicsWebApi.associate","relatedCollection"),c.stringParameterCheck(i,"DynamicsWebApi.associate","relationshipName"),t=c.keyParameterCheck(t,"DynamicsWebApi.associate","primaryKey"),r=c.keyParameterCheck(r,"DynamicsWebApi.associate","relatedKey"),c.callbackParameterCheck(o,"DynamicsWebApi.associate","successCallback"),c.callbackParameterCheck(s,"DynamicsWebApi.associate","errorCallback"),a("POST",{_additionalUrl:i+"/$ref",collection:e,key:t,impersonate:l,data:{"@odata.id":n+"("+r+")"}},"associate",function(){o()},s)},this.disassociate=function(e,t,i,n,r,o,s){c.stringParameterCheck(e,"DynamicsWebApi.disassociate","collection"),c.stringParameterCheck(i,"DynamicsWebApi.disassociate","relationshipName"),t=c.keyParameterCheck(t,"DynamicsWebApi.disassociate","primaryKey"),n=c.keyParameterCheck(n,"DynamicsWebApi.disassociate","relatedKey"),c.callbackParameterCheck(r,"DynamicsWebApi.disassociate","successCallback"),c.callbackParameterCheck(o,"DynamicsWebApi.disassociate","errorCallback"),a("DELETE",{_additionalUrl:i+"("+n+")/$ref",collection:e,key:t,impersonate:s},"disassociate",function(){r()},o)},this.associateSingleValued=function(e,t,i,n,r,o,s,l){c.stringParameterCheck(e,"DynamicsWebApi.associateSingleValued","collection"),t=c.keyParameterCheck(t,"DynamicsWebApi.associateSingleValued","key"),r=c.keyParameterCheck(r,"DynamicsWebApi.associateSingleValued","relatedKey"),c.stringParameterCheck(i,"DynamicsWebApi.associateSingleValued","singleValuedNavigationPropertyName"),c.stringParameterCheck(n,"DynamicsWebApi.associateSingleValued","relatedCollection"),c.callbackParameterCheck(o,"DynamicsWebApi.associateSingleValued","successCallback"),c.callbackParameterCheck(s,"DynamicsWebApi.associateSingleValued","errorCallback"),a("PUT",{_additionalUrl:i+"/$ref",collection:e,key:t,impersonate:l,data:{"@odata.id":n+"("+r+")"}},"associateSingleValued",function(){o()},s)},this.disassociateSingleValued=function(e,t,i,n,r,o){c.stringParameterCheck(e,"DynamicsWebApi.disassociateSingleValued","collection"),t=c.keyParameterCheck(t,"DynamicsWebApi.disassociateSingleValued","key"),c.stringParameterCheck(i,"DynamicsWebApi.disassociateSingleValued","singleValuedNavigationPropertyName"),c.callbackParameterCheck(n,"DynamicsWebApi.disassociateSingleValued","successCallback"),c.callbackParameterCheck(r,"DynamicsWebApi.disassociateSingleValued","errorCallback"),a("DELETE",{_additionalUrl:i+"/$ref",key:t,collection:e,impersonate:o},"disassociateSingleValued",function(){n()},r)},this.executeUnboundFunction=function(e,t,a,i,n){y(e,i,null,null,t,a,n,!0)},this.executeBoundFunction=function(e,t,a,i,n,r,c){y(a,r,t,e,i,n,c)};var y=function(e,t,i,n,o,s,l,u){c.stringParameterCheck(e,"DynamicsWebApi.executeFunction","functionName"),c.callbackParameterCheck(o,"DynamicsWebApi.executeFunction","successCallback"),c.callbackParameterCheck(s,"DynamicsWebApi.executeFunction","errorCallback");var p={_additionalUrl:e+r.buildFunctionParameters(t),_unboundRequest:u,key:n,collection:i,impersonate:l};a("GET",p,"executeFunction",function(e){e.data?o(e.data):o()},s)};this.executeUnboundAction=function(e,t,a,i,n){h(e,t,null,null,a,i,n,!0)},this.executeBoundAction=function(e,t,a,i,n,r,c){h(a,i,t,e,n,r,c)};var h=function(e,t,i,n,r,o,s,l){c.stringParameterCheck(e,"DynamicsWebApi.executeAction","actionName"),c.callbackParameterCheck(r,"DynamicsWebApi.executeAction","successCallback"),c.callbackParameterCheck(o,"DynamicsWebApi.executeAction","errorCallback"),a("POST",{_additionalUrl:e,_unboundRequest:l,collection:i,key:n,impersonate:s,data:t},"executeAction",function(e){e.data?r(e.data):r()},o)};this.createEntity=function(e,t,a){c.parameterCheck(e,"DynamicsWebApi.createEntity","entityDefinition");var i={collection:"EntityDefinitions",entity:e};this.createRequest(i,t,a)},this.updateEntity=function(e,t,a,i){c.parameterCheck(e,"DynamicsWebApi.updateEntity","entityDefinition"),c.guidParameterCheck(e.MetadataId,"DynamicsWebApi.updateEntity","entityDefinition.MetadataId");var n={collection:"EntityDefinitions",mergeLabels:i,key:e.MetadataId,entity:e};this.updateRequest(n,t,a)},this.retrieveEntity=function(e,t,a,i,n){c.keyParameterCheck(e,"DynamicsWebApi.retrieveEntity","entityKey");var r={collection:"EntityDefinitions",key:e,select:i,expand:n};this.retrieveRequest(r,t,a)},this.retrieveEntities=function(e,t,a,i){var n={collection:"EntityDefinitions",select:a,filter:i};this.retrieveRequest(n,e,t)},this.createAttribute=function(e,t,a,i){c.keyParameterCheck(e,"DynamicsWebApi.createAttribute","entityKey"),c.parameterCheck(t,"DynamicsWebApi.createAttribute","attributeDefinition");var n={collection:"EntityDefinitions",key:e,entity:t,navigationProperty:"Attributes"};this.createRequest(n,a,i)},this.updateAttribute=function(e,t,a,i,n,r){c.keyParameterCheck(e,"DynamicsWebApi.updateAttribute","entityKey"),c.parameterCheck(t,"DynamicsWebApi.updateAttribute","attributeDefinition"),c.guidParameterCheck(t.MetadataId,"DynamicsWebApi.updateAttribute","attributeDefinition.MetadataId"),n&&c.stringParameterCheck(n,"DynamicsWebApi.updateAttribute","attributeType");var o={collection:"EntityDefinitions",key:e,entity:t,navigationProperty:"Attributes",navigationPropertyKey:t.MetadataId,mergeLabels:r,metadataAttributeType:n};this.updateRequest(o,a,i)},this.retrieveAttributes=function(e,t,a,i,n,r,o){c.keyParameterCheck(e,"DynamicsWebApi.retrieveAttributes","entityKey"),i&&c.stringParameterCheck(i,"DynamicsWebApi.retrieveAttributes","attributeType");var s={collection:"EntityDefinitions",key:e,navigationProperty:"Attributes",select:n,filter:r,expand:o,metadataAttributeType:i};this.retrieveRequest(s,t,a)},this.retrieveAttribute=function(e,t,a,i,n,r,o){c.keyParameterCheck(e,"DynamicsWebApi.retrieveAttribute","entityKey"),c.keyParameterCheck(t,"DynamicsWebApi.retrieveAttribute","attributeKey"),n&&c.stringParameterCheck(n,"DynamicsWebApi.retrieveAttribute","attributeType");var s={collection:"EntityDefinitions",key:e,navigationProperty:"Attributes",select:r,expand:o,metadataAttributeType:n,navigationPropertyKey:t};this.retrieveRequest(s,a,i)},this.createRelationship=function(e,t,a){c.parameterCheck(e,"DynamicsWebApi.createRelationship","relationshipDefinition");var i={collection:"RelationshipDefinitions",entity:e};this.createRequest(i,t,a)},this.updateRelationship=function(e,t,a,i,n){c.parameterCheck(e,"DynamicsWebApi.updateRelationship","relationshipDefinition"),c.guidParameterCheck(e.MetadataId,"DynamicsWebApi.updateRelationship","relationshipDefinition.MetadataId");var r={collection:"RelationshipDefinitions",mergeLabels:n,key:e.MetadataId,entity:e,navigationProperty:i};this.updateRequest(r,t,a)},this.deleteRelationship=function(e,t,a){c.keyParameterCheck(e,"DynamicsWebApi.deleteRelationship","metadataId");var i={collection:"RelationshipDefinitions",key:e};this.deleteRequest(i,t,a)},this.retrieveRelationships=function(e,t,a,i,n){var r={collection:"RelationshipDefinitions",navigationProperty:a,select:i,filter:n};this.retrieveMultipleRequest(r,e,t)},this.retrieveRelationship=function(e,t,a,i,n){c.keyParameterCheck(e,"DynamicsWebApi.retrieveRelationship","metadataId");var r={collection:"RelationshipDefinitions",navigationProperty:i,key:e,select:n};this.retrieveRequest(r,t,a)},this.createGlobalOptionSet=function(e,t,a){c.parameterCheck(e,"DynamicsWebApi.createGlobalOptionSet","globalOptionSetDefinition");var i={collection:"GlobalOptionSetDefinitions",entity:e};this.createRequest(i,t,a)},this.updateGlobalOptionSet=function(e,t,a,i){c.parameterCheck(e,"DynamicsWebApi.updateGlobalOptionSet","globalOptionSetDefinition"),c.guidParameterCheck(e.MetadataId,"DynamicsWebApi.updateGlobalOptionSet","globalOptionSetDefinition.MetadataId");var n={collection:"GlobalOptionSetDefinitions",mergeLabels:i,key:e.MetadataId,entity:e};this.updateRequest(n,t,a)},this.deleteGlobalOptionSet=function(e,t,a){c.keyParameterCheck(e,"DynamicsWebApi.deleteGlobalOptionSet","globalOptionSetKey");var i={collection:"GlobalOptionSetDefinitions",key:e};this.deleteRequest(i,t,a)},this.retrieveGlobalOptionSet=function(e,t,a,i,n){c.keyParameterCheck(e,"DynamicsWebApi.retrieveGlobalOptionSet","globalOptionSetKey");var r={collection:"GlobalOptionSetDefinitions",key:e,navigationProperty:i,select:n};this.retrieveRequest(r,t,a)},this.retrieveGlobalOptionSets=function(e,t,a,i){var n={collection:"GlobalOptionSetDefinitions",navigationProperty:a,select:i};this.retrieveMultipleRequest(n,e,t)},this.initializeInstance=function(e){return e||(e=t),new i(e)}}var n=a(0),r=a(4),c=(a(3),a(1)),o=a(5);String.prototype.endsWith&&String.prototype.startsWith||a(2),i.prototype.utility={getCollectionName:o.getCollectionName},e.exports=i},function(e,t){e.exports=function(e,t){var a;return"string"==typeof t&&(a=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:Z|[-+]\d{2}:\d{2})$/.exec(t))?new Date(Date.UTC(+a[1],+a[2]-1,+a[3],+a[4],+a[5],+a[6])):t}},function(e,t,a){function i(e){var t=e.substr(0,e.indexOf("\r\n")),a=e.split(t);a.shift(),a.pop();for(var i=[],n=0;n<a.length;n++){var r=a[n],c=r.substring(r.indexOf("{"),r.lastIndexOf("}")+1);i.push(JSON.parse(c,o))}return i}function n(e,t){var a=null;if(-1!==e.indexOf("@")){var i=e.split("@");switch(i[1]){case"odata.context":a="oDataContext";break;case"odata.count":a="oDataCount",t=null!=t?parseInt(t):0;break;case"odata.nextLink":a="oDataNextLink";break;case c.Prefer.Annotations.FormattedValue:a=i[0]+"_Formatted";break;case c.Prefer.Annotations.AssociatedNavigationProperty:a=i[0]+"_NavigationProperty";break;case c.Prefer.Annotations.LookupLogicalName:a=i[0]+"_LogicalName"}}return[a,t]}function r(e){for(var t=Object.keys(e),a=0;a<t.length;a++){var i=t[a];if(null!=e[i]&&e[i].constructor===Array)for(var c=0;c<e[i].length;c++)e[i][c]=r(e[i][c]);var o=n(i,e[i]);if(o[0]&&(e[o[0]]=o[1]),-1!==i.indexOf("_x002e_")){var s=i.split("_x002e_");if(e.hasOwnProperty(s[0])){if("object"!=typeof e[s[0]]||"object"==typeof e[s[0]]&&!e[s[0]].hasOwnProperty("_dwaType"))throw new Error("The alias name of the linked entity must be unique!")}else e[s[0]]={_dwaType:"alias"};e[s[0]][s[1]]=e[i],o=n(s[1],e[i]),o[0]&&(e[s[0]][o[0]]=o[1])}}return e}var c=a(0),o=a(7);String.prototype.endsWith&&String.prototype.startsWith||a(2),e.exports=function(e){var t=null;return e.length&&(t=t=e.indexOf("--batchresponse_")>-1?i(e)[0]:JSON.parse(e,o),t=r(t)),t}},function(e,t){e.exports=function(e){var t={};if(!e)return t;for(var a=e.split("\r\n"),i=0,n=a.length;i<n;i++){var r=a[i],c=r.indexOf(": ");c>0&&(t[r.substring(0,c)]=r.substring(c+2))}return t}},function(e,t,a){var i=a(8),n=a(9),r=function(e,t,a,r,c,o,s){var l=new XMLHttpRequest;l.open(e,t,s);for(var u in r)l.setRequestHeader(u,r[u]);l.onreadystatechange=function(){if(4===l.readyState){switch(l.status){case 200:case 201:case 204:case 304:var e=i(l.responseText),t={data:e,headers:n(l.getAllResponseHeaders()),status:l.status};c(t);break;default:var a;try{a=JSON.parse(l.response).error}catch(e){a=l.response.length>0?{message:l.response}:{message:"Unexpected Error"}}a.status=l.status,a.statusText=l.statusText,o(a)}l=null}},l.onerror=function(){o({message:"Network Error"}),l=null},l.ontimeout=function(e){o({message:"Request Timed Out"}),l=null},a?l.send(a):l.send()};e.exports=r},function(e,t){e.exports=function(e){if(e){for(var t=Object.keys(e),a="",i="",n=1;n<=t.length;n++){var r=t[n-1],c=e[r];n>1&&(a+=",",i+="&"),a+=r+"=@p"+n,i+="@p"+n+"="+("string"==typeof c?"'"+c+"'":c)}return"("+a+")?"+i}return"()"}},function(e,t,a){var i=a(0),n=a(1);e.exports=function(e,t,a){var r,c=e.returnRepresentation,o=e.includeAnnotations,s=e.maxPageSize;if(e.prefer&&e.prefer.length){n.stringOrArrayParameterCheck(e.prefer,"DynamicsWebApi."+t,"request.prefer"),r=e.prefer,"string"==typeof r&&(r=r.split(","));for(var l in r){var u=r[l].trim();u===i.Prefer.ReturnRepresentation?c=!0:u.startsWith("odata.include-annotations=")?o=u.replace("odata.include-annotations=","").replace(/"/g,""):u.startsWith("odata.maxpagesize=")&&(s=u.replace("odata.maxpagesize=","").replace(/"/g,""))}}return r=[],a&&(null==c&&(c=a.returnRepresentation),o=o||a.includeAnnotations,s=s||a.maxPageSize),c&&(n.boolParameterCheck(c,"DynamicsWebApi."+t,"request.returnRepresentation"),r.push(i.Prefer.ReturnRepresentation)),o&&(n.stringParameterCheck(o,"DynamicsWebApi."+t,"request.includeAnnotations"),r.push('odata.include-annotations="'+o+'"')),s&&s>0&&(n.numberParameterCheck(s,"DynamicsWebApi."+t,"request.maxPageSize"),r.push("odata.maxpagesize="+s)),r.join(",")}},function(e,t){e.exports=function(e){var t=/\/(\w+)\(([0-9A-F]{8}[-]?([0-9A-F]{4}[-]?){3}[0-9A-F]{12})/i.exec(e["@odata.id"]);return{id:t[2],collection:t[1],oDataContext:e["@odata.context"]}}},function(e,t){e.exports=function(e,t){e=e||"",t=t||1,e=unescape(unescape(e));var a=/pagingcookie="(<cookie page="(\d+)".+<\/cookie>)/.exec(e);if(null!=a){var i=parseInt(a[2]);return{cookie:a[1].replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"'").replace(/\'/g,"&quot;"),page:i,nextPage:i+1}}return{cookie:"",page:t,nextPage:t+1}}}])});