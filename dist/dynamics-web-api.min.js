/*! dynamics-web-api v1.1.2 (c) 2017 Aleksandr Rogov */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.DynamicsWebApi=t():e.DynamicsWebApi=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t){var n={Types:{ResponseBase:function(){this.oDataContext=""},Response:function(){n.Types.ResponseBase.call(this),this.value={}},ReferenceResponse:function(){n.Types.ResponseBase.call(this),this.id="",this.collection=""},MultipleResponse:function(){n.Types.ResponseBase.call(this),this.oDataNextLink="",this.oDataCount=0,this.value=[]},FetchXmlResponse:function(){n.Types.ResponseBase.call(this),this.value=[],this.PagingInfo={cookie:"",page:0,nextPage:1}}},Prefer:{ReturnRepresentation:"return=representation",Annotations:{AssociatedNavigationProperty:"Microsoft.Dynamics.CRM.associatednavigationproperty",LookupLogicalName:"Microsoft.Dynamics.CRM.lookuplogicalname",All:"*",FormattedValue:"OData.Community.Display.V1.FormattedValue",FetchXmlPagingCookie:"Microsoft.Dynamics.CRM.fetchxmlpagingcookie"}}};e.exports=n},function(e,t,n){function i(e){var t=function(){if("undefined"!=typeof Xrm){var e=Xrm.Page.context.getClientUrl();return e.match(/\/$/)&&(e=e.substring(0,e.length-1)),e}return""},n="8.0",r=null,s=function(){return t()+"/api/data/v"+n+"/"},o=s(),c=function(e,t){return"string"==typeof e&&e.endsWith("@odata.bind")&&"string"==typeof t&&!t.startsWith(o)&&(t=o+t),t},u=function(e,t){return"string"==typeof t&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$/.exec(t)?new Date(t):t},l=function(e){var t={};if(!e)return t;for(var n=e.split("\r\n"),i=0,a=n.length;i<a;i++){var r=n[i],s=r.indexOf(": ");s>0&&(t[r.substring(0,s)]=r.substring(s+2))}return t},p=function(e,t,n,i){return new Promise(function(a,s){var p=new XMLHttpRequest;if(p.open(e,encodeURI(o+t),!0),p.setRequestHeader("OData-MaxVersion","4.0"),p.setRequestHeader("OData-Version","4.0"),p.setRequestHeader("Accept","application/json"),p.setRequestHeader("Content-Type","application/json; charset=utf-8"),r&&(!i||i&&!i.MSCRMCallerID)&&p.setRequestHeader("MSCRMCallerID",r),null!=i)for(var d=Object.keys(i),f=0;f<d.length;f++)p.setRequestHeader(d[f],i[d[f]]);p.onreadystatechange=function(){if(4===this.readyState)switch(p.onreadystatechange=null,this.status){case 200:case 201:case 204:case 304:var e=null;this.responseText&&(e=JSON.parse(this.responseText,u));a({data:e,headers:l(this.getAllResponseHeaders()),status:this.status});break;default:s(this)}},n?p.send(JSON.stringify(n,c)):p.send()})},d=function(e,t,n,i){if(void 0===e||null===e||""==e)throw new Error(i?t+" requires the "+n+" parameter with type: "+i:t+" requires the "+n+" parameter.")},f=function(e,t,n){if("string"!=typeof e)throw new Error(t+" requires the "+n+" parameter is a String.")},h=function(e,t,n){if(e.constructor!==Array)throw new Error(t+" requires the "+n+" parameter is an Array.")},y=function(e,t,n){if("number"!=typeof e)throw new Error(t+" requires the "+n+" parameter is a Number.")},m=function(e,t,n){if("boolean"!=typeof e)throw new Error(t+" requires the "+n+" parameter is a Boolean.")},A=function(e,t,n){try{return/[0-9A-F]{8}[-]?([0-9A-F]{4}[-]?){3}[0-9A-F]{12}/i.exec(e)[0]}catch(e){throw new Error(t+" requires the "+n+" parameter is a GUID String.")}};this.setConfig=function(e){e.webApiVersion&&(f(e.webApiVersion,"DynamicsWebApi.setConfig","config.webApiVersion"),n=e.webApiVersion,o=s()),e.webApiUrl&&(f(e.webApiUrl,"DynamicsWebApi.setConfig","config.webApiUrl"),o=e.webApiUrl),e.impersonate&&(r=A(e.impersonate,"DynamicsWebApi.setConfig","config.impersonate"))},null!=e&&this.setConfig(e);var D=function(e){var t=/\/(\w+)\(([0-9A-F]{8}[-]?([0-9A-F]{4}[-]?){3}[0-9A-F]{12})/i.exec(e["@odata.id"]);return{id:t[2],collection:t[1],oDataContext:e["@odata.context"]}},b=function(e,t,n,i){var r={},s=[];if(i=null!=i?i:"&",e){if(e.navigationProperty&&(f(e.navigationProperty,"DynamicsWebApi."+t,"request.navigationProperty"),n+="/"+e.navigationProperty),null!=e.select&&e.select.length&&(h(e.select,"DynamicsWebApi."+t,"request.select"),"retrieve"==t&&1==e.select.length&&e.select[0].endsWith("/$ref")?n+="/"+e.select[0]:(e.select[0].startsWith("/")&&"retrieve"==t&&(null==e.navigationProperty?n+=e.select.shift():e.select.shift()),e.select.length&&s.push("$select="+e.select.join(",")))),e.filter&&(f(e.filter,"DynamicsWebApi."+t,"request.filter"),s.push("$filter="+e.filter)),e.savedQuery&&s.push("savedQuery="+A(e.savedQuery,"DynamicsWebApi."+t,"request.savedQuery")),e.userQuery&&s.push("userQuery="+A(e.userQuery,"DynamicsWebApi."+t,"request.userQuery")),e.maxPageSize&&e.maxPageSize>0&&(y(e.maxPageSize,"DynamicsWebApi."+t,"request.maxPageSize"),r.Prefer="odata.maxpagesize="+e.maxPageSize),e.count&&(m(e.count,"DynamicsWebApi."+t,"request.count"),s.push("$count="+e.count)),e.top&&e.top>0&&(y(e.top,"DynamicsWebApi."+t,"request.top"),s.push("$top="+e.top)),null!=e.orderBy&&e.orderBy.length&&(h(e.orderBy,"DynamicsWebApi."+t,"request.orderBy"),s.push("$orderBy="+e.orderBy.join(","))),e.returnRepresentation&&(m(e.returnRepresentation,"DynamicsWebApi."+t,"request.returnRepresentation"),r.Prefer=a.Prefer.ReturnRepresentation),e.includeAnnotations&&(f(e.includeAnnotations,"DynamicsWebApi."+t,"request.includeAnnotations"),r.Prefer='odata.include-annotations="'+e.includeAnnotations+'"'),null!=e.ifmatch&&null!=e.ifnonematch)throw Error("DynamicsWebApi."+t+". Either one of request.ifmatch or request.ifnonematch parameters shoud be used in a call, not both.");if(e.ifmatch&&(f(e.ifmatch,"DynamicsWebApi."+t,"request.ifmatch"),r["If-Match"]=e.ifmatch),e.ifnonematch&&(f(e.ifnonematch,"DynamicsWebApi."+t,"request.ifnonematch"),r["If-None-Match"]=e.ifnonematch),e.impersonate&&(f(e.impersonate,"DynamicsWebApi."+t,"request.impersonate"),r.MSCRMCallerID=A(e.impersonate,"DynamicsWebApi."+t,"request.impersonate")),null!=e.expand&&e.expand.length){h(e.expand,"DynamicsWebApi."+t,"request.expand");for(var o=[],c=0;c<e.expand.length;c++)if(e.expand[c].property){var u=b(e.expand[c],t+" $expand",null,";").query;u.length&&(u="("+u+")"),o.push(e.expand[c].property+u)}o.length&&s.push("$expand="+encodeURI(o.join(",")))}}return{url:n,query:s.join(i),headers:r}},g=function(e,t){e.collection?f(e.collection,"DynamicsWebApi."+t,"request.collection"):d(e.collection,"DynamicsWebApi."+t,"request.collection");var n=e.collection.toLowerCase();e.id&&(A(e.id,"DynamicsWebApi."+t,"request.id"),n+="("+e.id+")");var i=b(e,t,n);return i.query&&(i.url+="?"+i.query),{url:i.url,headers:i.headers}};this.create=function(e,t,n){d(e,"DynamicsWebApi.create","object"),f(t,"DynamicsWebApi.create","collection");var i={};return null!=n&&(f(n,"DynamicsWebApi.create","prefer"),i.Prefer=n),p("POST",t.toLowerCase(),e,i).then(function(e){if(e.data)return e.data;var t=e.headers["OData-EntityId"];return/[0-9A-F]{8}[-]?([0-9A-F]{4}[-]?){3}[0-9A-F]{12}/i.exec(t)[0]})},this.retrieveRequest=function(e){d(e,"DynamicsWebApi.retrieve","request");var t=g(e,"retrieve"),n=e.select;return p("GET",t.url,null,t.headers).then(function(e){return null!=n&&1==n.length&&n[0].endsWith("/$ref")&&null!=e.data["@odata.id"]?D(e.data):e.data})},this.retrieve=function(e,t,n,i){f(e,"DynamicsWebApi.retrieve","id"),e=A(e,"DynamicsWebApi.retrieve","id"),f(t,"DynamicsWebApi.retrieve","collection");var a=t.toLowerCase()+"("+e+")",r=[];return null!=n&&n.length&&(h(n,"DynamicsWebApi.retrieve","select"),1==n.length&&n[0].endsWith("/$ref")&&n[0].endsWith("/$ref")?a+="/"+n[0]:(n[0].startsWith("/")&&(a+=n.shift()),n.length&&r.push("$select="+n.join(",")))),null!=i&&(f(i,"DynamicsWebApi.retrieve","expand"),r.push("$expand="+i)),r.length&&(a+="?"+r.join("&")),p("GET",a).then(function(e){return null!=n&&1==n.length&&n[0].endsWith("/$ref")&&null!=e.data["@odata.id"]?D(e.data):e.data})},this.updateRequest=function(e){d(e,"DynamicsWebApi.update","request"),d(e.entity,"DynamicsWebApi.update","request.entity");var t=g(e,"update");null==e.ifmatch&&(t.headers["If-Match"]="*");var n=e.ifmatch;return p("PATCH",t.url,e.entity,t.headers).then(function(e){return!e.data||e.data}).catch(function(e){if(n&&412==e.status)return!1;throw e})},this.update=function(e,t,n,i,a){f(e,"DynamicsWebApi.update","id"),e=A(e,"DynamicsWebApi.update","id"),d(n,"DynamicsWebApi.update","object"),f(t,"DynamicsWebApi.update","collection");var r={"If-Match":"*"};null!=i&&(f(i,"DynamicsWebApi.update","prefer"),r.Prefer=i);var s="";return null!=a&&(h(a,"DynamicsWebApi.update","select"),a.length>0&&(s="?$select="+a.join(","))),p("PATCH",t.toLowerCase()+"("+e+")"+s,n,r).then(function(e){if(e.data)return e.data})},this.updateSingleProperty=function(e,t,n,i){f(e,"DynamicsWebApi.updateSingleProperty","id"),e=A(e,"DynamicsWebApi.updateSingleProperty","id"),d(n,"DynamicsWebApi.updateSingleProperty","keyValuePair"),f(t,"DynamicsWebApi.updateSingleProperty","collection");var a=Object.keys(n)[0],r=n[a],s={};return null!=i&&(f(i,"DynamicsWebApi.updateSingleProperty","prefer"),s.Prefer=i),p("PUT",t.toLowerCase()+"("+e+")/"+a,{value:r},s).then(function(e){if(e.data)return e.data})},this.deleteRequest=function(e){d(e,"DynamicsWebApi.delete","request");var t=g(e,"delete"),n=e.ifmatch;return p("DELETE",t.url,null,t.headers).then(function(){return!0}).catch(function(e){if(n&&412==e.status)return!1;throw e})},this.deleteRecord=function(e,t,n){f(e,"DynamicsWebApi.deleteRequest","id"),e=A(e,"DynamicsWebApi.deleteRequest","id"),f(t,"DynamicsWebApi.deleteRequest","collection"),null!=n&&f(n,"DynamicsWebApi.deleteRequest","propertyName");var i=t.toLowerCase()+"("+e+")";return null!=n&&(i+="/"+n),p("DELETE",i).then(function(){})},this.upsertRequest=function(e){d(e,"DynamicsWebApi.upsert","request"),d(e.entity,"DynamicsWebApi.upsert","request.entity");var t=g(e,"upsert"),n=e.ifnonematch,i=e.ifmatch;return p("PATCH",t.url,e.entity,t.headers).then(function(e){if(e.headers["OData-EntityId"]){var t=e.headers["OData-EntityId"];return/[0-9A-F]{8}[-]?([0-9A-F]{4}[-]?){3}[0-9A-F]{12}/i.exec(t)[0]}if(e.data)return e.data}).catch(function(e){if(!(n&&412==e.status||i&&404==e.status))throw e})},this.upsert=function(e,t,n,i,a){f(e,"DynamicsWebApi.upsert","id"),e=A(e,"DynamicsWebApi.upsert","id"),d(n,"DynamicsWebApi.upsert","object"),f(t,"DynamicsWebApi.upsert","collection");var r={};null!=i&&(f(i,"DynamicsWebApi.upsert","prefer"),r.Prefer=i);var s="";return null!=a&&(h(a,"DynamicsWebApi.upsert","select"),a.length>0&&(s="?$select="+a.join(","))),p("PATCH",t.toLowerCase()+"("+e+")"+s,n,r).then(function(e){if(e.headers["OData-EntityId"]){var t=e.headers["OData-EntityId"];return/[0-9A-F]{8}[-]?([0-9A-F]{4}[-]?){3}[0-9A-F]{12}/i.exec(t)[0]}if(e.data)return e.data})};var W=function(e,t){t&&!e.collection&&(e.collection="any");var n=g(e,"retrieveMultiple");t&&(f(t,"DynamicsWebApi.retrieveMultiple","nextPageLink"),n.url=unescape(t).replace(o,""));var i=e.count;return p("GET",n.url,null,n.headers).then(function(e){return null!=e.data["@odata.nextLink"]&&(e.data.oDataNextLink=e.data["@odata.nextLink"]),i&&(e.data.oDataCount=null!=e.data["@odata.count"]?parseInt(e.data["@odata.count"]):0),null!=e.data["@odata.context"]&&(e.data.oDataContext=e.data["@odata.context"]),e.data})};this.retrieveMultipleRequest=W,this.count=function(e,t){return null==t||null!=t&&!t.length?(f(e,"DynamicsWebApi.count","collection"),p("GET",e.toLowerCase()+"/$count").then(function(e){return e.data?parseInt(e.data):0})):this.retrieveMultipleRequest({collection:e,filter:t,count:!0},null).then(function(e){return e.oDataCount?e.oDataCount:0})},this.retrieveMultiple=function(e,t,n,i){return this.retrieveMultipleRequest({collection:e,select:t,filter:n},i)};var v=function(e,t){try{e=unescape(unescape(e));var n=/pagingcookie="(<cookie page="(\d+)".+<\/cookie>)/.exec(e);if(null!=n){var i=parseInt(n[2]);return{cookie:n[1].replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"'").replace(/\'/g,"&quot;"),page:i,nextPage:i+1}}return{cookie:"",page:t,nextPage:t+1}}catch(e){throw new Error(e)}};this.executeFetchXml=function(e,t,n,i,a,r){f(e,"DynamicsWebApi.executeFetchXml","type"),f(t,"DynamicsWebApi.executeFetchXml","fetchXml"),null==i&&(i=1),y(i,"DynamicsWebApi.executeFetchXml","pageNumber");var s="$1 page='"+i+"'";null!=a&&(f(a,"DynamicsWebApi.executeFetchXml","pagingCookie"),s+=" paging-cookie='"+a+"'"),t=t.replace(/^(<fetch[\w\d\s'"=]+)/,s);var o={};null!=n&&(f(n,"DynamicsWebApi.executeFetchXml","includeAnnotations"),o.Prefer='odata.include-annotations="'+n+'"'),null!=r&&(r=A(r,"DynamicsWebApi.executeFetchXml","impersonateUserId"),header.MSCRMCallerID=r);var c=escape(t);return p("GET",e.toLowerCase()+"?fetchXml="+c,null,o).then(function(e){return null!=e.data["@Microsoft.Dynamics.CRM.fetchxmlpagingcookie"]&&(e.data.PagingInfo=v(e.data["@Microsoft.Dynamics.CRM.fetchxmlpagingcookie"],i)),null!=e.data["@odata.context"]&&(e.data.oDataContext=e.data["@odata.context"]),e.data})},this.associate=function(e,t,n,i,a,r){f(e,"DynamicsWebApi.associate","primarycollection"),f(i,"DynamicsWebApi.associate","relatedcollection"),f(n,"DynamicsWebApi.associate","relationshipName"),t=A(t,"DynamicsWebApi.associate","primaryId"),a=A(a,"DynamicsWebApi.associate","relatedId");var s={};return null!=r&&(r=A(r,"DynamicsWebApi.associate","impersonateUserId"),s.MSCRMCallerID=r),p("POST",e+"("+t+")/"+n+"/$ref",{"@odata.id":o+i+"("+a+")"},s).then(function(){})},this.disassociate=function(e,t,n,i,a){f(e,"DynamicsWebApi.disassociate","primarycollection"),f(n,"DynamicsWebApi.disassociate","relationshipName"),t=A(t,"DynamicsWebApi.disassociate","primaryId"),i=A(i,"DynamicsWebApi.disassociate","relatedId");var r={};return null!=a&&(a=A(a,"DynamicsWebApi.associate","impersonateUserId"),r.MSCRMCallerID=a),p("DELETE",e+"("+t+")/"+n+"("+i+")/$ref",null,r).then(function(){})},this.associateSingleValued=function(e,t,n,i,a,r){f(e,"DynamicsWebApi.associateSingleValued","collection"),t=A(t,"DynamicsWebApi.associateSingleValued","id"),a=A(a,"DynamicsWebApi.associateSingleValued","relatedId"),f(n,"DynamicsWebApi.associateSingleValued","singleValuedNavigationPropertyName"),f(i,"DynamicsWebApi.associateSingleValued","relatedcollection");var s={};return null!=r&&(r=A(r,"DynamicsWebApi.associate","impersonateUserId"),s.MSCRMCallerID=r),p("PUT",e+"("+t+")/"+n+"/$ref",{"@odata.id":o+i+"("+a+")"},s).then(function(){})},this.disassociateSingleValued=function(e,t,n,i){f(e,"DynamicsWebApi.disassociateSingleValued","collection"),t=A(t,"DynamicsWebApi.disassociateSingleValued","id"),f(n,"DynamicsWebApi.disassociateSingleValued","singleValuedNavigationPropertyName");var a={};return null!=i&&(i=A(i,"DynamicsWebApi.associate","impersonateUserId"),a.MSCRMCallerID=i),p("DELETE",e+"("+t+")/"+n+"/$ref",null,a).then(function(){})},this.executeUnboundFunction=function(e,t,n){return q(e,t,null,null,n)},this.executeBoundFunction=function(e,t,n,i,a){return q(n,i,t,e,a)};var x=function(e){if(e){for(var t=Object.keys(e),n="",i="",a=1;a<=t.length;a++){var r=t[a-1],s=e[r];a>1&&(n+=",",i+="&"),n+=r+"=@p"+a,i+="@p"+a+"="+("string"==typeof s?"'"+s+"'":s)}return"("+n+")?"+i}return"()"},q=function(e,t,n,i,a){f(e,"DynamicsWebApi.executeFunction","functionName");var r=e+x(t);null!=n&&(f(n,"DynamicsWebApi.executeFunction","collection"),i=A(i,"DynamicsWebApi.executeFunction","id"),r=n+"("+i+")/"+r);var s={};return null!=a&&(s.MSCRMCallerID=A(a,"DynamicsWebApi.associate","impersonateUserId")),p("GET",r,null,s).then(function(e){if(e.data)return e.data})};this.executeUnboundAction=function(e,t,n){return C(e,t,null,null,n)},this.executeBoundAction=function(e,t,n,i,a){return C(n,i,t,e,a)};var C=function(e,t,n,i,a){f(e,"DynamicsWebApi.executeAction","actionName");var r=e;null!=n&&(f(n,"DynamicsWebApi.executeAction","collection"),i=A(i,"DynamicsWebApi.executeAction","id"),r=n+"("+i+")/"+r);var s={};return null!=a&&(a=A(a,"DynamicsWebApi.executeAction","impersonateUserId"),s.MSCRMCallerID=a),p("POST",r,t,s).then(function(e){if(e.data)return e.data})};this.initializeInstance=function(e){return e||(e={impersonate:r,webApiUrl:o,webApiVersion:n}),new i(e)}}var a=n(0);String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var n=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>n.length)&&(t=n.length),t-=e.length;var i=n.lastIndexOf(e,t);return i!==-1&&i===t}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e}),e.exports=i}])});